<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <!-- ========================= -->
    <!-- VUELOS -->
    <!-- ========================= -->

    <record id="view_vuelo_tree" model="ir.ui.view">
        <field name="name">dronify.vuelo.tree</field>
        <field name="model">dronify.vuelo</field>
        <field name="arch" type="xml">
            <tree>
                <field name="codigo"/>
                <field name="name"/>
                <field name="dron_id"/>
                <field name="piloto_id"/>
                <field name="peso_total"/>
                <field name="consumo_estimado" widget="percentage"/>
                <field name="preparado" widget="boolean_toggle" class="text-center"/>
                <field name="realizado" widget="boolean_toggle" class="text-center"/>
            </tree>
        </field>
    </record>

    <record id="view_vuelo_form" model="ir.ui.view">
        <field name="name">dronify.vuelo.form</field>
        <field name="model">dronify.vuelo</field>
        <field name="arch" type="xml">
            <form string="Vuelo">
                <header>
                    <button name="action_preparar_vuelo"
                            type="object"
                            string="Preparar Vuelo"
                            class="btn-primary"
                            attrs="{'invisible':[('preparado','=',True)]}"/>

                    <button name="action_desbloquear"
                            type="object"
                            string="Desbloquear"
                            attrs="{'invisible':[('preparado','=',False)]}"/>

                    <button name="action_finalizar_vuelo"
                            type="object"
                            string="Finalizar Vuelo"
                            attrs="{'invisible':[('realizado','=',True)]}"/>
                </header>

                <sheet>

                    <group string="Planificación">
                        <field name="name"
                               attrs="{'readonly':[('preparado','=',True)]}"/>
                        <field name="dron_id"
                               attrs="{'readonly':[('preparado','=',True)]}"/>
                        <field name="piloto_id"
                               attrs="{'readonly':[('preparado','=',True)]}"/>
                    </group>

                    <group string="Estado y Control">
                        <field name="preparado" readonly="1"/>
                        <field name="realizado" readonly="1"/>
                        <field name="peso_total" readonly="1"/>
                        <field name="consumo_estimado" widget="percentage" readonly="1"/>
                    </group>

                    <notebook>
                        <page string="Paquetes">
                            <field name="paquetes_ids"
                                   attrs="{'readonly':[('preparado','=',True)]}">
                                <tree editable="bottom">
                                    <field name="codigo"/>
                                    <field name="name"/>
                                    <field name="peso"/>
                                    <field name="cliente_id"/>
                                </tree>
                            </field>

                            <group>
                                <field name="peso_total" readonly="1"/>
                                <field name="consumo_estimado" widget="percentage" readonly="1"/>
                            </group>
                        </page>
                    </notebook>

                </sheet>
            </form>
        </field>
    </record>


    <!-- ========================= -->
    <!-- DRONES -->
    <!-- ========================= -->

    <record id="view_dron_tree" model="ir.ui.view">
        <field name="name">dronify.dron.tree</field>
        <field name="model">dronify.dron</field>
        <field name="arch" type="xml">
            <tree decoration-danger="bateria &lt; 25">
                <field name="name"/>
                <field name="capacidad_max"/>
                <field name="bateria" widget="progressbar"/>
                <field name="estado" widget="badge"
                       decoration-success="estado == 'disponible'"
                       decoration-warning="estado == 'vuelo'"
                       decoration-danger="estado == 'taller'"/>
            </tree>
        </field>
    </record>


    <!-- ========================= -->
    <!-- PAQUETES -->
    <!-- ========================= -->

    <record id="view_paquete_tree" model="ir.ui.view">
        <field name="name">dronify.paquete.tree</field>
        <field name="model">dronify.paquete</field>
        <field name="arch" type="xml">
            <tree>
                <field name="codigo"/>
                <field name="name"/>
                <field name="peso"/>
                <field name="cliente_id"/>
                <field name="vuelo_id"/>
                <field name="dron_relacionado"/>
            </tree>
        </field>
    </record>


    <!-- ========================= -->
    <!-- ACCIONES -->
    <!-- ========================= -->

    <record id="action_vuelos" model="ir.actions.act_window">
        <field name="name">Vuelos</field>
        <field name="res_model">dronify.vuelo</field>
        <field name="view_mode">tree,form</field>
    </record>

    <record id="action_drones" model="ir.actions.act_window">
        <field name="name">Drones</field>
        <field name="res_model">dronify.dron</field>
        <field name="view_mode">tree,form</field>
    </record>

    <record id="action_paquetes" model="ir.actions.act_window">
        <field name="name">Paquetes</field>
        <field name="res_model">dronify.paquete</field>
        <field name="view_mode">tree</field>
    </record>

    <record id="action_pilotos" model="ir.actions.act_window">
        <field name="name">Pilotos</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('es_piloto','=',True)]</field>
        <field name="context">{'default_es_piloto': True}</field>
    </record>

    <record id="action_clientes" model="ir.actions.act_window">
        <field name="name">Clientes</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('es_cliente','=',True)]</field>
        <field name="context">{'default_es_cliente': True}</field>
    </record>


    <!-- ========================= -->
    <!-- MENÚ -->
    <!-- ========================= -->

    <menuitem id="menu_dronify_root"
              name="Dronify"/>

    <menuitem id="menu_operaciones"
              name="Operaciones"
              parent="menu_dronify_root"/>

    <menuitem id="menu_vuelos"
              name="Vuelos"
              parent="menu_operaciones"
              action="action_vuelos"/>

    <menuitem id="menu_paquetes"
              name="Paquetes"
              parent="menu_operaciones"
              action="action_paquetes"/>

    <menuitem id="menu_flotas"
              name="Flota"
              parent="menu_dronify_root"/>

    <menuitem id="menu_drones"
              name="Drones"
              parent="menu_flotas"
              action="action_drones"/>

    <menuitem id="menu_contactos"
              name="Contactos"
              parent="menu_dronify_root"/>

    <menuitem id="menu_pilotos"
              name="Pilotos"
              parent="menu_contactos"
              action="action_pilotos"/>

    <menuitem id="menu_clientes"
              name="Clientes"
              parent="menu_contactos"
              action="action_clientes"/>

</odoo>
